<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <link rel="manifest" href="/images/site.webmanifest">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.kaikai.men","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":"default"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqusjs","storage":true,"lazyload":false,"nav":{"disqusjs":{"text":"Load Disqus","order":-1}},"activeClass":"disqusjs"},"stickytabs":true,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.18.0/config.min.js"></script>

    <meta name="description" content="问题在知乎上看见了个有意思的问题：  孤独素数：一个素数 P 通常可以分为两个殆素数之和，其序数与对应的殆素数的素因子序数同时满足：\begin{equation*}\begin{cases}P &#x3D; \prod p_i + \prod q_i \\\pi(P)&#x3D;\prod \pi(p_i) + \prod \pi(q_i)\end{cases}\end{equation*}例如">
<meta property="og:type" content="article">
<meta property="og:title" content="『孤独素数』的定义与搜索算法">
<meta property="og:url" content="https://www.kaikai.men/lonely-primes-define-and-algo/index.html">
<meta property="og:site_name" content="小名开开">
<meta property="og:description" content="问题在知乎上看见了个有意思的问题：  孤独素数：一个素数 P 通常可以分为两个殆素数之和，其序数与对应的殆素数的素因子序数同时满足：\begin{equation*}\begin{cases}P &#x3D; \prod p_i + \prod q_i \\\pi(P)&#x3D;\prod \pi(p_i) + \prod \pi(q_i)\end{cases}\end{equation*}例如">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.kaikai.men/attach/2025/08/dist.png">
<meta property="og:image" content="https://www.kaikai.men/attach/2025/08/prodpifactor_1000.png">
<meta property="og:image" content="https://www.kaikai.men/attach/2025/08/prodpifactor_30000.png">
<meta property="og:image" content="https://www.kaikai.men/attach/2025/08/prodpifactor_value_29000_30000.png">
<meta property="article:published_time" content="2025-08-14T20:22:58.000Z">
<meta property="article:modified_time" content="2025-08-30T14:15:58.639Z">
<meta property="article:author" content="kaikai">
<meta property="article:tag" content="殆素数">
<meta property="article:tag" content="编程练习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.kaikai.men/attach/2025/08/dist.png">


<link rel="canonical" href="https://www.kaikai.men/lonely-primes-define-and-algo/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.kaikai.men/lonely-primes-define-and-algo/","path":"/lonely-primes-define-and-algo/","title":"『孤独素数』的定义与搜索算法"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>『孤独素数』的定义与搜索算法 | 小名开开</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="/css/collapse.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="小名开开" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">小名开开</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">在春天的光影里喘息</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-bell fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">130</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">15</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">406</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96"><span class="nav-number">2.</span> <span class="nav-text">优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F"><span class="nav-number">3.</span> <span class="nav-text">观察</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="kaikai"
      src="/images/boat.jpg">
  <p class="site-author-name" itemprop="name">kaikai</p>
  <div class="site-description" itemprop="description">当时只道是寻常</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">130</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">406</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/kaikaiiiiiii" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;kaikaiiiiiii" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/id/kaikaiiiiiii" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;id&#x2F;kaikaiiiiiii" rel="noopener me" target="_blank"><i class="fab fa-steam fa-fw"></i>Steam</a>
      </span>
      <span class="links-of-author-item">
        <a href="/yourkaikai##gmail.com" title="Email → yourkaikai##gmail.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>Email</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>
<!--
<div class="sidebar-button animated">
  <a target="_blank" rel="noopener" href="https://app.gitter.im/#/room/#next:gitter.im">
    <i class="fab fa-gitter"></i>
    Gitter Chat
  </a>
</div>
<div class="cc-license animated" itemprop="sponsor">
  <span class="exturl cc-opacity" title="Deploy with Netlify → https://www.netlify.com" data-url="aHR0cHM6Ly93d3cubmV0bGlmeS5jb20="><img width="120" src="https://www.netlify.com/img/global/badges/netlify-dark.svg" alt="Netlify"></span>
</div>
-->
        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.kaikai.men/lonely-primes-define-and-algo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/boat.jpg">
      <meta itemprop="name" content="kaikai">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小名开开">
      <meta itemprop="description" content="当时只道是寻常">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="『孤独素数』的定义与搜索算法 | 小名开开">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          『孤独素数』的定义与搜索算法
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-08-14 20:22:58" itemprop="dateCreated datePublished" datetime="2025-08-14T20:22:58Z">2025-08-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%A1%AC%E7%94%A8%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">硬用数学</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>在知乎上看见了个有意思的问题：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/1936101307632060385">孤独素数：</a><br>一个素数 P 通常可以分为两个殆素数之和，其序数与对应的殆素数的素因子序数同时满足：<br>\begin{equation*}<br>\begin{cases}<br>P &#x3D; \prod p_i + \prod q_i \\<br>\pi(P)&#x3D;\prod \pi(p_i) + \prod \pi(q_i)<br>\end{cases}<br>\end{equation*}<br>例如 $11 &#x3D; 2*3 + 5$，同时有 $\pi(11) &#x3D; 5 &#x3D; \pi(2)\pi(3) + \pi(5) &#x3D; 1\cdot2 + 3。$<br>但也存在一些素数，任意分法均不能满足上述规则，称为孤独素数。</p>
</blockquote>
<p>看见这题我是懵逼的，懵逼树上懵逼果，第一步直接撞死在黎曼猜想了，想不到在 $\pi(p)$ 还没有明确公式解的情况下怎么去判断孤独素数的规律。但至少这个看起来是个简单而有趣的编程练习题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 欧拉筛法获得 n 以内的素数表</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">EulerSieve</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> primes = [];</span><br><span class="line">    <span class="keyword">let</span> eularboard = <span class="keyword">new</span> <span class="title class_">Array</span>(n + <span class="number">1</span>).<span class="title function_">fill</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (eularboard[i]) &#123;</span><br><span class="line">            primes.<span class="title function_">push</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; primes.<span class="property">length</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i * primes[j] &gt; n) <span class="keyword">break</span>;</span><br><span class="line">            eularboard[i * primes[j]] = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % primes[j] === <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> primes;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> primes = <span class="title class_">EulerSieve</span>(<span class="number">10</span> ** <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算殆素数的素因子序数乘积，并使用使用 dp 避免重复的因式分解</span></span><br><span class="line"><span class="keyword">const</span> dp = [];</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">factorOrdersProduct</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (dp[n]) <span class="keyword">return</span> dp[n];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> init = n;</span><br><span class="line">    <span class="keyword">const</span> sqrt_n = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(n));</span><br><span class="line">    <span class="keyword">let</span> indices = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; primes.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> p = primes[i];</span><br><span class="line">        <span class="keyword">if</span> (p &gt; sqrt_n) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">while</span> (n % p === <span class="number">0</span>) &#123;</span><br><span class="line">            indices = indices * (i + <span class="number">1</span>);</span><br><span class="line">            n = n / p;</span><br><span class="line">            <span class="keyword">if</span> (dp[n]) &#123;</span><br><span class="line">                indices = indices * dp[n];</span><br><span class="line">                n = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> idx = primes.<span class="title function_">indexOf</span>(n);</span><br><span class="line">        <span class="keyword">if</span> (idx === -<span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Math crisis <span class="subst">$&#123;n&#125;</span>`</span>);</span><br><span class="line">        indices = indices * (idx + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dp[init] = indices;</span><br><span class="line">    <span class="keyword">return</span> indices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 寻找孤立素数，将每个素数分解成两个殆素数，然后计算殆素数的素因子序数乘积</span></span><br><span class="line"><span class="keyword">const</span> lonelyPrimes = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; primes.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> p = primes[i];</span><br><span class="line">    <span class="keyword">let</span> lonely = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> m = <span class="number">2</span>; m &lt; p / <span class="number">2</span>; m++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">factorOrdersProduct</span>(m) + <span class="title function_">factorOrdersProduct</span>(p - m) === i + <span class="number">1</span>) &#123;</span><br><span class="line">            lonely = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (lonely) &#123;</span><br><span class="line">        lonelyPrimes.<span class="title function_">push</span>(p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(lonelyPrimes);</span><br><span class="line"><span class="comment">// 2, 3, 211, 277, 541, 631, 653, 1259, 2797, 2897, 4391, 5279, 5323, 5381, 5527,  6113, 6547, 7177, 7523, 7993, 8147, 8513, 9157, 9661, 10211, ...</span></span><br></pre></td></tr></table></figure>

<p>实测下来 Apple M1 上计算 $10^6$ 以内孤独素数约 3.5 秒，$10^7$ 以内约 180 秒。</p>
<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>整体来看上述代码是清晰的，先用欧拉筛获得素数数组，再根据孤独素数的定义逐个验证。由于殆素数分解是必然有解的，实际上就是验证第二条件序列数的运算是否成立。通过 dp 暂存已经计算过的结果，可以大大提高效率。但直观来看，还有一些可以优化的小点：</p>
<ol>
<li>在规模不大的时候，可以使用字典对象储存素数与其序数的键值对，替代 primes.indexOf(n)。一个对象可以容纳 2^24 个键值对，即最大素数为 $p_{(2^{24})}$，查询得知 $p_{16777216}&#x3D;310248241$，足够大了。更大规模也可以使用若干个字典对象来应对。</li>
<li>如果一个殆素数因子序数乘积已经超过了当前素数序数，可以提前结束。但需要考虑每次增加的判断带来的损耗是否小于节约的时间。考虑到：$\pi(p) \approx p &#x2F; \ln p$，殆素数 m 大概率为合数， $\pi(m) &lt;\prod_i(m_i&#x2F;ln m_i), m &#x3D; \sum_i m_i$，m-q 同理。而 $lnp$ 显然是大于 1 的，因此可以认为这种提前结束的情况几乎不存在。在极端情况下，m&#x3D;2，p 与 p-2 为孪生素数，也只是等于序列数的和。因此这一条更大可能是负面的。</li>
<li>使用 UInt32Array 等定长数组优化，这个我不是很喜欢。我知道它有效，但总觉得将语言特性也视为算法本身的优化的话，汇编就是唯一可用的语言了。</li>
</ol>
<p>以及一个可能存在的大优化点：</p>
<p><strong>在欧拉筛获得素数的过程中，我们已经把所有的合数都计算过一遍了</strong></p>
<p>这意味着 factorOrdersProduct(n) 函数的计算过程，与筛法取素数的计算过程本身是有大量重合的。在题目的定义下，素数 p 的两个加数几乎就覆盖了从 1-n 的所有合数，也就是筛法求素数中被筛去的数，以及筛选这个动作本身也是有价值的。</p>
<p>值得一提的是，在因数分解相关算法中有个 SPF(Smallest Prime Factor) 算法。它与欧拉筛是完美配合的。简单地说，SPF 分为两步：</p>
<ol>
<li>在筛法取素数过程中，保留合数而不是直接筛去，并记录每个数最小质因数。</li>
<li>在因数分解过程中，使用类似递归的方法，根据最小质因数快速计算各合数的全部因子。</li>
</ol>
<p>在第 1. 步中将 SPF 与欧拉筛结合，并将第 2 步中的计算因子数组改为计算因子序数乘积，即可得到更高效的搜搜代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> n = <span class="number">10</span> ** <span class="number">6</span>;</span><br><span class="line"><span class="keyword">const</span> spf = <span class="keyword">new</span> <span class="title class_">Uint32Array</span>(n + <span class="number">1</span>).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> primes = [];</span><br><span class="line"><span class="keyword">const</span> primeIndex = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="keyword">const</span> product = <span class="keyword">new</span> <span class="title class_">Uint32Array</span>(n + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建SPF和素数序号</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (spf[i] === <span class="number">0</span>) &#123;</span><br><span class="line">        spf[i] = i;</span><br><span class="line">        primes.<span class="title function_">push</span>(i);</span><br><span class="line">        primeIndex.<span class="title function_">set</span>(i, primes.<span class="property">length</span>); <span class="comment">// 记录素数序号</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; primes.<span class="property">length</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">const</span> p = primes[j];</span><br><span class="line">        <span class="keyword">const</span> ip = i * p;</span><br><span class="line">        <span class="keyword">if</span> (p &gt; spf[i] || ip &gt; n) <span class="keyword">break</span>;</span><br><span class="line">        spf[ip] = p;</span><br><span class="line">        <span class="keyword">if</span> (i % p === <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接计算因子序数乘积</span></span><br><span class="line">product[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> p = spf[i]; <span class="comment">// 最小质因数</span></span><br><span class="line">    <span class="keyword">const</span> prev = i / p;</span><br><span class="line">    product[i] = product[prev] * primeIndex.<span class="title function_">get</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 寻找孤立素数</span></span><br><span class="line"><span class="keyword">const</span> lonelyPrimes = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> idx = <span class="number">0</span>; idx &lt; primes.<span class="property">length</span>; idx++) &#123;</span><br><span class="line">    <span class="keyword">const</span> p = primes[idx];</span><br><span class="line">    <span class="keyword">const</span> target = idx + <span class="number">1</span>; <span class="comment">// primeIndex[p]</span></span><br><span class="line">    <span class="keyword">const</span> half = <span class="title class_">Math</span>.<span class="title function_">floor</span>(p / <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">let</span> lonely = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> m = <span class="number">2</span>; m &lt; half; m++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (product[m] + product[p - m] === target) &#123;</span><br><span class="line">            lonely = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (lonely) lonelyPrimes.<span class="title function_">push</span>(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优化结果是 $10^6$ 以内约 0.8 秒，$10^7$ 以内约 52 秒，$10^8$ 约 8900 秒。</p>
<blockquote>
<p>在 JS 实现中，对于相同的查询请求，性能排序大约是 Uint32Array &gt; Array $\approx$ Object &gt; Map。但 V8 引擎存在 bug，导致 Array 或 Object 在用作 primeIndex 时出现了预料之外的错误，不得不用 Map()。这就是为什么我不喜欢基于语言特有数据结构的优化。而相同的 python 代码虽然可以天然地支持更大的数字而无需考虑这些异常，也无需考虑默认 2GB 的内存上限，但代价是慢得多的计算速度以及单位计算量下更大的内存占用。在计算规模上升后还不如 nodejs 实用。</p>
</blockquote>
<h2 id="观察"><a href="#观察" class="headerlink" title="观察"></a>观察</h2><p>在有了高效的孤独素数搜索算法以后，可以对其序列进行一些观察。</p>
<ol>
<li><p>分布。</p>
<p> 从计算结果看，孤独素数很稀疏，且存在较大的波动。但计算到 1 亿，以 10 万为一段统计其出现的频率，发现和素数本身的分布趋势是大致一致的。</p>
<p> <img src="/../attach/2025/08/dist.png" alt="分布" loading="lazy"></p>
<blockquote>
<p>绿色为素数数量分布参考线 $\pi(p)&#x3D;p &#x2F; \ln p$</p>
</blockquote>
</li>
<li><p>解的分布。</p>
<p> 对于非孤独素数，第一个解往往在 m 较小时就出现了。一般地，对于 p &#x3D; m + q 的情况，上述算法是从 m &#x3D; 2 开始逐项验证的，等效于从 p 左边的所有数中取任意两个，使 $\pi(p)$ 有解。先来看一下所有数的因子序数积的分布情况。</p>
<p> <img src="/../attach/2025/08/prodpifactor_1000.png" alt="前1000个整数的因子序数积的分布" loading="lazy"></p>
<blockquote>
<p>前 1000 个整数的因子序数积的分布</p>
</blockquote>
<p> <img src="/../attach/2025/08/prodpifactor_30000.png" alt="前30000个整数的因子序数积的分布" loading="lazy"></p>
<blockquote>
<p>前 30000 个整数的因子序数积的分布</p>
</blockquote>
<p> 从图中我们发现，整数的因子序数积的分布出现了明显的原点出发放射状图样，最上面一条显然是质数和其对应的序列数。随着 x 轴放大点数密集，放射线变得更为清晰。因此我们进行局部放大并标注具体数据后如下：</p>
<p> <img src="/../attach/2025/08/prodpifactor_value_29000_30000.png" alt="29000到30000整数的因子序数积的分布" loading="lazy"></p>
<blockquote>
<p>29000 到 30000 个整数的因子序数积的分布及数值标注</p>
</blockquote>
<p> 经过简单计算，就可以发现素数线以下的第二条线是 $3\times素数$，再下面第三条线是 $5\times素数$。</p>
<p> 根据图像发现一个推论，若素数 p&#39; 与 p $\frac{p&#39;}{p} \approx \frac{1}{3}$，则 $\frac{1}{3} &lt; \frac{\pi(p&#39;)}{\pi(p)} &lt; \frac{1}{2}$，所以才有 $3\times素数$ 线稳定在素数线下。</p>
<p> 当 p 足够大时，$\pi(p)\approx p &#x2F; ln(p)$，假设存在一个与 p 几乎相等的殆素数 3p&#39;。则有：<br> $$ \frac{\pi(3)\cdot\pi(p&#39;)}{\pi(p)}\approx \frac{2p}{3ln(p&#x2F;3)} &#x2F; \frac{p}{lnp} &#x3D; \frac{2}{3}\cdot\frac{lnp}{lnp-ln3}$$<br> 令 $t&#x3D;lnp$, $c&#x3D;ln3$，则比值 $r(t)&#x3D;\frac{2}{3}\cdot\frac{t}{t-c}$，其中$t&gt;c$ ，即$p&gt;3$。</p>
<ul>
<li>若 $r(t)&gt;1$，则 $2t&gt;3t-3c \Rightarrow t&lt;3c \Rightarrow lnp&lt;ln27 \Rightarrow p&lt;27$</li>
<li>若 $r(t)&#x3D;1$，则 $p &#x3D; 27$</li>
<li>若 $r(t)&lt;1$，则 $p &gt; 27$</li>
</ul>
<p> 也就是说  在 p 足够大时，$\pi(p) &gt; \pi(3)\cdot\pi(p&#39;)$，因此殆素数 3p&#39; 构成的因子序数积的线一定在 $\pi(p)$ 下方。</p>
<p> 以同相方法，容易比较 2p&#39;、5p&#39; 等不同殆素数构成的线条的相对位置。进一步地，n 阶殆素数也可以以类似的方法确定相对顺序。</p>
<p> 特殊地，因为$\pi(2)&#x3D;1$，所以 $2^n$ 是最底部恒等于 1 的横线。</p>
</li>
<li><p>p &#x3D; m + q</p>
<p> 根据上一条的结论，对于一个殆素数，每增加一个因子，它的因子序数积都是变小的，因为对任意 p 都有 $\pi(p)&lt;p$。所以通常来说，其中一个值是较小的质数，会让等式成立的概率更大。</p>
<p> 如果两个都是殆素数，最优情况也至少是 $p&#x3D;3p_1+5p_2$，如果 p 足够大，此时要求 $p&#x2F;lnp &#x3D; 2p_1&#x2F;lnp_1+4p_2&#x2F;lnp_2$，若 m 与 n 大小类似，容易导致 $p_1, p_2$ 过小。</p>
<p> 也就是说，$\pi(p)&#x3D;\prod \pi(p_i) + \prod \pi(p_j)$ 等式要成立，可以调节的空间大小就是 $p&#x2F;lnp - (p_i&#x2F;lnp_i + p_j&#x2F;lnp_j)$，这个当然没有稳定解，但从趋势上容易理解，m q 差异越大的，殆素数因子越少的，越容易得到解。</p>
</li>
<li><p>特例与猜想</p>
<ul>
<li>孪生素数中较大的一个，一定不是孤独素数，这结论还挺文学的。</li>
<li>有无穷多个孤独素数。</li>
<li>指定 m 为任何 2 以上整数，都可以找到 p 与 q 使得公式成立。</li>
</ul>
</li>
</ol>
<p>得不出什么普遍性的结论，思而不学民科一下。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%AE%86%E7%B4%A0%E6%95%B0/" rel="tag"># 殆素数</a>
              <a href="/tags/%E7%BC%96%E7%A8%8B%E7%BB%83%E4%B9%A0/" rel="tag"># 编程练习</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/calcaulate-the-pi/" rel="prev" title="圆周率：从割圆法到级数展开">
                  <i class="fa fa-angle-left"></i> 圆周率：从割圆法到级数展开
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/invalid-array-length-bug-in-nodejs-v8/" rel="next" title="V8 引擎中的 Invalid array length bug">
                  V8 引擎中的 Invalid array length bug <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments disqusjs-container">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2012 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">kaikai</span>
  </div><div class="footer-custom">
</div>


    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="120" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.18.0/comments.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.18.0/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.18.0/motion.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.18.0/next-boot.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.18.0/pjax.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.18.0/third-party/search/local-search.min.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.18.0/third-party/math/mathjax.min.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/disqusjs/3.0.2/styles/disqusjs.css" integrity="sha256-71XarXwNr1Td27HmZI9zjY+rMzRdush6/glo6VFXp7o=" crossorigin="anonymous">

<script class="next-config" data-name="disqusjs" type="application/json">{"enable":true,"api":"https://disqus.kaikai.men/api/","apikey":"C2pY6mOd3bemkdJokRCJZC5mdjrKjLZzM5b0U9P341OLdPfUYGUmj8ePLZahvfx4","shortname":"kaikaiiiiiii","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/disqusjs/3.0.2/disqusjs.es2015.umd.min.js","integrity":"sha256-okP99ZQKVpIy7+NogAMpGlIQzJa9XKXhIJcFgdju5bU="}}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.18.0/third-party/comments/disqusjs.min.js"></script>

<!-- hexo injector body_end start -->
<script src="/js/collapse.js"></script>
<!-- hexo injector body_end end --></body>
</html>
